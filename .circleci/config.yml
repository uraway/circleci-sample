version: 2.1

jobs:
  proofreading_job:
    docker:
      - image: circleci/node
    environment:
      REVIEWDOG_VERSION: 0.9.12
    parameters:
      REVIEWDOG_GITHUB_API_TOKEN:
        type: env_var_name
        default: REVIEWDOG_GITHUB_API_TOKEN
    steps:
      - checkout
      - run:
          name: "依存モジュールをインストールする"
          command: npm install
      - run:
          name: "textlintをREADME.mdに対して実行する"
          command: $(npm bin)/textlint -f checkstyle README.md >> .textling.log
      - run:
          name: "reviewdogをインストールする"
          command: |
            curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s  v$REVIEWDOG_VERSION
      - run:
          name: "reviewdogを実行する"
          when: on_fail
          command: |
            cat check_result .textlint.log | ./bin/reviewdog -f=checkstyle -name="textlint" -reporter="github-pr-check"

workflows:
  version: 2
  proofreading:
    jobs:
      - proofreading_job:
          REVIEWDOG_GITHUB_API_TOKEN: GITHUB_API_TOKEN
