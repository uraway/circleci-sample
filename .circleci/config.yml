version: 2.1

jobs:
  build:
    docker:
      - image: busybox
    steps:
      - run: |
          docker run -d --name circleci-sample -p 3000:3000 circleci-sample
          sleep 10
          # 次のコマンドは失敗する
          # curl --retry 10 --retry-connrefused http://localhost:3000
          # 次のコマンドは成功する
          docker exec circleci-sample curl --retry 10 --retry-connrefused http://localhost:3000

workflows:
  version: 2
  workflow:
    jobs:
      - build
