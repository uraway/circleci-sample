version: 2

jobs:
    install_deps:
        docker:
            - image: alpine
        steps:
            - run: echo "Install Deps"
    test_1:
        docker:
            - image: alpine
        steps:
            - run: echo "test_1" > foo.bin
            - run: apk add --no-cache ca-certificates
            - persist_to_workspace:
                root: ./
                paths:
                  - "foo.bin"
    test_2:
        docker:
            - image: alpine
        steps:
            - run: echo "test_2" > foo.bin
            - run: apt-get update && apt-get install -y ca-certificates
            - persist_to_workspace:
                root: ./
                paths:
                  - "foo.bin"
    deploy:
        docker:
            - image: alpine
        steps:
            - attach_workspace:
                  at: ./
            - run: echo "Install Deps"

workflows:
  version: 2
  workflow:
    jobs:
      - install_deps # ... ジョブA
      - test_1:      # ... ジョブB
          requires:
            - install_deps
      - test_2:      # ... ジョブC
          requires:
            - install_deps
      - deploy:      # ... ジョブD
          requires:
            - test_1
            - test_2
